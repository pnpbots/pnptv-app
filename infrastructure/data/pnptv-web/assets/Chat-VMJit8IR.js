import{u as J,i as O,j as e,k as Q,l as H,m as B,n as X,o as Y,p as Z}from"./index-Cn0k-BHZ.js";import{u as ee,r as a}from"./vendor-DD6IjSBT.js";import"./auth-BkcVUzVN.js";function se(l){if(!l)return"";const u=Date.now()-new Date(l).getTime(),i=Math.floor(u/6e4);if(i<1)return"now";if(i<60)return`${i}m`;const c=Math.floor(i/60);return c<24?`${c}h`:`${Math.floor(c/24)}d`}function ne(){const{user:l}=J(),u=ee(),i=(l==null?void 0:l.subscriptionType)==="prime"||(l==null?void 0:l.subscriptionType)==="active",[c,R]=a.useState([]),[V,w]=a.useState(!0),[v,N]=a.useState(null),[b,f]=a.useState(!1),[x,y]=a.useState(""),[k,C]=a.useState(""),[p,E]=a.useState(!1),[W,M]=a.useState("list"),[n,L]=a.useState(null),[j,o]=a.useState([]),[P,S]=a.useState(!1),[m,I]=a.useState(""),[A,G]=a.useState(!1),D=a.useRef(null),r=a.useRef(null),[U,d]=a.useState(null),h=a.useCallback(async()=>{try{const s=await O();R(s.groups||[]),N(null)}catch{N("Failed to load groups")}},[]);a.useEffect(()=>{w(!0),h().finally(()=>w(!1))},[h]);const _=async()=>{if(!(!x.trim()||p)){E(!0);try{await Q(x.trim(),k.trim()),y(""),C(""),f(!1),h()}catch{}finally{E(!1)}}},$=async s=>{L(s),M("chat"),o([]),d(null),S(!0);try{const t=await H(s.id);o(t.messages||[])}catch{}finally{S(!1)}if(s.hasActiveCall)try{const t=await B(s.id);t.jitsiUrl&&d(t.jitsiUrl)}catch{}r.current&&clearInterval(r.current),r.current=setInterval(async()=>{try{const t=await H(s.id);o(t.messages||[])}catch{}},5e3)},g=()=>{M("list"),L(null),o([]),d(null),r.current&&(clearInterval(r.current),r.current=null),h()};a.useEffect(()=>()=>{r.current&&clearInterval(r.current)},[]),a.useEffect(()=>{var s;(s=D.current)==null||s.scrollIntoView({behavior:"smooth"})},[j]);const F=async()=>{if(!m.trim()||A||!n)return;G(!0);const s=m.trim();I("");try{const t=await X(n.id,s);t.success&&t.message&&o(q=>[...q,t.message])}catch{}finally{G(!1)}},z=async()=>{if(n)try{const s=await B(n.id);s.jitsiUrl?d(s.jitsiUrl):alert("Video calls are not available right now. Please try again later.")}catch{alert("Failed to start video call. Please try again later.")}},T=async s=>{try{await Y(s),g()}catch{}},K=async s=>{try{await Z(s),g()}catch{}};return W==="chat"&&n?e.jsxs("div",{className:"flex flex-col",style:{height:"calc(100vh - 5rem)"},children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-white/5",children:[e.jsx("button",{onClick:g,className:"text-white",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-sm font-bold text-white truncate",children:n.name}),e.jsxs("p",{className:"text-xs",style:{color:"#8E8E93"},children:[n.memberCount," members"]})]}),e.jsx("button",{onClick:z,className:"w-9 h-9 rounded-full flex items-center justify-center",style:{background:"rgba(230, 145, 56, 0.15)"},children:e.jsx("svg",{className:"w-5 h-5",style:{color:"#E69138"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!n.isMain&&e.jsx("button",{onClick:()=>{n.creatorId===(l==null?void 0:l.dbId)?K(n.id):T(n.id)},className:"text-xs px-2 py-1 rounded",style:{color:"#FF453A"},children:n.creatorId===(l==null?void 0:l.dbId)?"Delete":"Leave"})]}),U&&e.jsxs("div",{className:"glass-card-sm mx-4 mt-2 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-white",children:"Video Call Active"})]}),e.jsx("button",{onClick:()=>d(null),className:"text-xs",style:{color:"#FF453A"},children:"Close"})]}),e.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:e.jsx("iframe",{src:U,className:"w-full h-full border-0",allow:"camera; microphone; display-capture; autoplay",title:"Video Call"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3",children:[P?e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"animate-pulse flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/10"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("div",{className:"h-3 bg-white/10 rounded w-24"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-48"})]})]},s))}):j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",style:{color:"#8E8E93"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-white font-medium text-sm",children:"No messages yet"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"#8E8E93"},children:"Be the first to say something!"})]}):j.map(s=>{const t=s.user_id===(l==null?void 0:l.dbId);return e.jsxs("div",{className:`flex gap-2 ${t?"flex-row-reverse":""}`,children:[s.photo_url?e.jsx("img",{src:s.photo_url,className:"w-8 h-8 rounded-full object-cover flex-shrink-0",alt:""}):e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",style:{background:t?"rgba(230, 145, 56, 0.2)":"rgba(212, 0, 122, 0.2)",color:t?"#E69138":"#D4007A"},children:(s.first_name||s.username||"?")[0].toUpperCase()}),e.jsxs("div",{className:`max-w-[75%] ${t?"text-right":""}`,children:[e.jsxs("div",{className:`flex items-center gap-1.5 mb-0.5 ${t?"justify-end":""}`,children:[e.jsx("span",{className:"text-xs font-medium text-white",children:s.first_name||s.username||"User"}),e.jsx("span",{className:"text-[10px]",style:{color:"#8E8E93"},children:se(s.created_at)})]}),e.jsx("div",{className:"rounded-2xl px-3 py-2 text-sm text-white",style:{background:t?"linear-gradient(135deg, #D4007A, #E69138)":"rgba(255,255,255,0.08)"},children:s.content})]})]},s.id)}),e.jsx("div",{ref:D})]}),e.jsx("div",{className:"px-4 py-3 border-t border-white/5",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:m,onChange:s=>I(s.target.value),onKeyDown:s=>s.key==="Enter"&&!s.shiftKey&&F(),placeholder:"Type a message...",className:"flex-1 bg-white/5 rounded-full px-4 py-2.5 text-sm text-white placeholder-white/30 focus:outline-none focus:ring-1 focus:ring-white/20",maxLength:2e3}),e.jsx("button",{onClick:F,disabled:!m.trim()||A,className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 disabled:opacity-30",style:{background:"linear-gradient(135deg, #D4007A, #E69138)"},children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]}):e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Hangouts"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#8E8E93"},children:"Group chats + video calls"})]}),i&&e.jsx("button",{onClick:()=>f(!b),className:"btn-gradient px-3 py-1.5 rounded-lg text-white text-xs font-semibold",children:"+ New Group"})]}),b&&e.jsxs("div",{className:"glass-card-sm p-4 mb-4 animate-fade-in-up",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Create Subgroup"}),e.jsx("input",{value:x,onChange:s=>y(s.target.value),placeholder:"Group name...",className:"w-full bg-white/5 rounded-lg px-3 py-2 text-sm text-white placeholder-white/30 focus:outline-none mb-2",maxLength:100}),e.jsx("textarea",{value:k,onChange:s=>C(s.target.value),placeholder:"Description (optional)...",className:"w-full bg-white/5 rounded-lg px-3 py-2 text-sm text-white placeholder-white/30 focus:outline-none mb-3 resize-none",rows:2,maxLength:500}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(!1),className:"flex-1 py-2 rounded-lg text-sm text-white/60 border border-white/10",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:!x.trim()||p,className:"flex-1 btn-gradient py-2 rounded-lg text-sm text-white font-semibold disabled:opacity-50",children:p?"Creating...":"Create"})]})]}),v&&e.jsx("div",{className:"glass-card-sm p-3 mb-4 border-l-4",style:{borderLeftColor:"#FF453A"},children:e.jsx("p",{className:"text-sm text-white/80",children:v})}),V?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"glass-card-sm p-4 animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-32"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-48"})]})]})},s))}):c.length===0?e.jsxs("div",{className:"glass-card-sm p-8 text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-3",style:{color:"#8E8E93"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})}),e.jsx("p",{className:"text-white font-medium mb-1",children:"No groups yet"}),e.jsx("p",{className:"text-sm",style:{color:"#8E8E93"},children:"Log in to join the community"})]}):e.jsx("div",{className:"space-y-2",children:c.map(s=>{var t;return e.jsx("button",{onClick:()=>$(s),className:"w-full glass-card-sm p-4 text-left hover:border-white/20 transition-colors",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold flex-shrink-0",style:{background:s.isMain?"linear-gradient(135deg, #D4007A, #E69138)":"rgba(212, 0, 122, 0.2)",color:s.isMain?"#fff":"#D4007A"},children:s.isMain?"P":(t=s.name[0])==null?void 0:t.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-white text-sm truncate",children:s.name}),s.isMain&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-white/10 text-white/60",children:"MAIN"}),s.hasActiveCall&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] text-green-400",children:"LIVE"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-xs",style:{color:"#8E8E93"},children:[s.memberCount," members"]}),s.lastMessage&&e.jsxs("span",{className:"text-xs truncate max-w-[180px]",style:{color:"#8E8E93"},children:["Â· ",s.lastMessage]})]})]}),e.jsx("svg",{className:"w-4 h-4 flex-shrink-0 self-center",style:{color:"#8E8E93"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},s.id)})}),!i&&e.jsxs("div",{className:"mt-6 glass-card-sm p-4 text-center",children:[e.jsx("p",{className:"text-sm text-white font-medium mb-1",children:"Want to create your own group?"}),e.jsx("p",{className:"text-xs mb-3",style:{color:"#8E8E93"},children:"Upgrade to PRIME to create subgroups with video calls"}),e.jsx("button",{onClick:()=>u("/profile"),className:"btn-gradient px-6 py-2 rounded-lg text-white text-sm font-semibold",children:"Upgrade to PRIME"})]})]})}export{ne as default};
