import{j as e,S as k,u as Y,b as K,c as q,d as G,C as p,T as J,B as Q,e as X}from"./index-Cn0k-BHZ.js";import{r as s}from"./vendor-DD6IjSBT.js";import{H as m}from"./media-BbSaIQh1.js";import{B as L}from"./Badge-BXfN9DIO.js";import"./auth-BkcVUzVN.js";function Z({src:c,title:h,poster:u}){const f=s.useRef(null),[n,l]=s.useState("loading");return s.useEffect(()=>{const o=f.current;if(!o||!c)return;let r=null;return m.isSupported()?(r=new m({enableWorker:!0,lowLatencyMode:!0}),r.loadSource(c),r.attachMedia(o),r.on(m.Events.MANIFEST_PARSED,()=>{l("live"),o.play().catch(()=>{})}),r.on(m.Events.ERROR,(T,j)=>{j.fatal&&(j.type===m.ErrorTypes.NETWORK_ERROR?l("offline"):l("error"))})):o.canPlayType("application/vnd.apple.mpegurl")?(o.src=c,o.addEventListener("loadedmetadata",()=>{l("live"),o.play().catch(()=>{})}),o.addEventListener("error",()=>l("error"))):l("error"),()=>{r==null||r.destroy()}},[c]),n==="loading"?e.jsxs("div",{className:"relative aspect-video rounded-xl overflow-hidden",children:[e.jsx(k,{className:"w-full h-full"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-pnp-accent border-t-transparent rounded-full animate-spin"})})]}):n==="offline"?e.jsx("div",{className:"relative aspect-video rounded-xl overflow-hidden bg-pnp-surface border border-pnp-border flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-pnp-textSecondary mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("p",{className:"text-pnp-textSecondary font-medium",children:"Stream Offline"}),e.jsx("p",{className:"text-sm text-pnp-textSecondary/60 mt-1",children:"Check back later"})]})}):e.jsxs("div",{className:"relative aspect-video rounded-xl overflow-hidden bg-black",children:[e.jsx("video",{ref:f,className:"w-full h-full object-contain",poster:u,playsInline:!0,controls:!0}),n==="live"&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx(L,{variant:"error",children:"LIVE"})}),h&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 pt-8",children:e.jsx("p",{className:"text-white font-medium",children:h})})]})}const O="https://booking.pnptv.app";function re(){const{isAuthenticated:c,login:h}=Y(),[u,f]=s.useState([]),[n,l]=s.useState(null),[o,r]=s.useState(!0),[T,j]=s.useState(null),[v,V]=s.useState([]),[E,C]=s.useState(!0),[M,W]=s.useState([]),[i,b]=s.useState(null),[A,P]=s.useState(""),[N,R]=s.useState(!1),[H,B]=s.useState(!1),[$,y]=s.useState(null),[_,S]=s.useState(null),[w,z]=s.useState(!1),[I,F]=s.useState(!1);s.useEffect(()=>{r(!0),K().then(t=>{const a=t.streams||[];f(a);const d=a.find(x=>x.isLive);d?l(d):a.length>0&&l(a[0])}).catch(t=>j(t.message)).finally(()=>r(!1))},[]),s.useEffect(()=>{C(!0),q().then(t=>{const a=t.performers||[];V(a),a.length>0&&!i&&b(a[0])}).catch(()=>{}).finally(()=>C(!1))},[]);const g=s.useCallback(()=>{G(5).then(t=>W(t.tips||[])).catch(()=>{})},[]);s.useEffect(()=>{g();const t=setInterval(g,15e3);return()=>clearInterval(t)},[g]);const U=async t=>{if(!c){h();return}if(!i){y("Select a performer to tip");return}B(!0),y(null),S(null);try{const a=await X(i.id,t,A||void 0);a.paymentUrl?(window.open(a.paymentUrl,"_blank","noopener,width=500,height=700"),S(`Payment window opened for $${t} tip`)):S(`$${t} tip submitted!`),P(""),R(!1),setTimeout(g,3e3)}catch(a){y(a instanceof Error?a.message:"Failed to send tip")}finally{B(!1)}},D=t=>{const a=Date.now()-new Date(t).getTime(),d=Math.floor(a/6e4);if(d<1)return"just now";if(d<60)return`${d}m ago`;const x=Math.floor(d/60);return x<24?`${x}h ago`:`${Math.floor(x/24)}d ago`};return e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-pnp-textPrimary",children:"Live"}),e.jsx("p",{className:"text-sm text-pnp-textSecondary mt-1",children:"Watch live broadcasts and tip performers"})]}),e.jsx(L,{variant:"error",children:"Live"})]}),o?e.jsx(k,{className:"aspect-video rounded-xl mb-4"}):n?e.jsxs("div",{className:"mb-4",children:[e.jsx(Z,{src:n.hlsUrl,title:n.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.isLive&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-red-400",children:"LIVE"})]}),e.jsx("span",{className:"text-sm text-pnp-textPrimary font-medium",children:n.name})]}),n.description&&e.jsx("p",{className:"text-sm text-pnp-textSecondary mt-1",children:n.description})]}):e.jsxs(p,{className:"text-center py-12 mb-4",children:[e.jsx("svg",{className:"w-16 h-16 text-pnp-textSecondary mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("p",{className:"text-pnp-textPrimary font-medium mb-1",children:"No Streams Available"}),e.jsx("p",{className:"text-sm text-pnp-textSecondary",children:"Check back later for live content"})]}),e.jsxs(p,{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-pnp-textPrimary",children:"Send a Tip"}),i&&e.jsxs("span",{className:"text-xs text-pnp-accent",children:["to ",i.name]})]}),v.length>1&&e.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto pb-1 -mx-1 px-1",children:v.map(t=>e.jsxs("button",{onClick:()=>b(t),className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs whitespace-nowrap transition-colors ${(i==null?void 0:i.id)===t.id?"bg-pnp-accent/20 text-pnp-accent border border-pnp-accent/30":"bg-pnp-surface border border-pnp-border text-pnp-textSecondary hover:border-pnp-accent/40"}`,children:[t.photo?e.jsx("img",{src:t.photo,alt:"",className:"w-4 h-4 rounded-full object-cover"}):e.jsx("span",{className:"w-4 h-4 rounded-full bg-pnp-accent/30 flex items-center justify-center text-[8px] text-pnp-accent font-bold",children:t.name.charAt(0)}),t.name]},t.id))}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:J.map(t=>e.jsxs("button",{onClick:()=>U(t),disabled:H,className:"flex-1 min-w-[56px] py-2 rounded-lg font-semibold text-sm transition-all bg-gradient-to-r from-amber-500/80 to-orange-500/80 text-white hover:from-amber-500 hover:to-orange-500 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:["$",t]},t))}),e.jsx("button",{onClick:()=>R(!N),className:"text-xs text-pnp-textSecondary mt-2 hover:text-pnp-accent transition-colors",children:N?"Hide message":"+ Add a message"}),N&&e.jsx("input",{type:"text",placeholder:"Your message (optional)",value:A,onChange:t=>P(t.target.value),maxLength:200,className:"w-full mt-2 rounded-lg bg-pnp-surface border border-pnp-border px-3 py-2 text-sm text-pnp-textPrimary placeholder-pnp-textSecondary focus:outline-none focus:ring-2 focus:ring-pnp-accent"}),$&&e.jsx("p",{className:"text-xs text-pnp-error mt-2",children:$}),_&&e.jsx("p",{className:"text-xs text-green-400 mt-2",children:_}),!c&&e.jsx("p",{className:"text-xs text-pnp-textSecondary mt-2",children:"Log in to send tips to performers"})]}),M.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xs font-medium text-pnp-textSecondary uppercase tracking-wider mb-2",children:"Recent Tips"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 -mx-1 px-1",children:M.map(t=>e.jsxs("div",{className:"flex-shrink-0 px-3 py-1.5 rounded-full bg-pnp-surface border border-pnp-border text-xs",children:[e.jsxs("span",{className:"text-pnp-accent font-medium",children:["$",t.amount]}),e.jsx("span",{className:"text-pnp-textSecondary mx-1",children:"by"}),e.jsxs("span",{className:"text-pnp-textPrimary",children:["@",t.user_username]}),e.jsxs("span",{className:"text-pnp-textSecondary ml-1",children:["to ",t.model_name]}),e.jsx("span",{className:"text-pnp-textSecondary/50 ml-1.5",children:D(t.created_at)})]},t.id))})]}),u.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-sm font-medium text-pnp-textSecondary uppercase tracking-wider mb-3",children:"All Streams"}),e.jsx("div",{className:"space-y-2 mb-6",children:u.map(t=>e.jsx(p,{onClick:()=>l(t),hover:!0,className:(n==null?void 0:n.id)===t.id?"border-pnp-accent":"",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.isLive?"bg-pnp-error animate-pulse":"bg-pnp-textSecondary"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-pnp-textPrimary",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-pnp-textSecondary truncate",children:t.description})]}),e.jsx(L,{variant:t.isLive?"error":"default",children:t.isLive?"LIVE":"Offline"})]})},t.id))})]}),!E&&v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-sm font-medium text-pnp-textSecondary uppercase tracking-wider mb-3",children:"Performers"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 mb-6",children:v.map(t=>e.jsx(p,{hover:!0,onClick:()=>b(t),className:(i==null?void 0:i.id)===t.id?"border-pnp-accent":"",children:e.jsxs("div",{className:"text-center",children:[t.photo?e.jsx("img",{src:t.photo,alt:t.name,className:"w-14 h-14 rounded-full object-cover mx-auto mb-2"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-pnp-accent/20 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-lg text-pnp-accent font-bold",children:t.name.charAt(0)})}),e.jsx("p",{className:"text-sm font-medium text-pnp-textPrimary truncate",children:t.name}),t.categories.length>0&&e.jsx("p",{className:"text-[10px] text-pnp-textSecondary truncate mt-0.5",children:Array.isArray(t.categories)?t.categories.join(", "):t.categories})]})},t.id))})]}),E&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 mb-6",children:[1,2,3].map(t=>e.jsx(k,{className:"h-28 rounded-xl"},t))}),T&&e.jsx("p",{className:"text-xs text-pnp-textSecondary mt-4",children:"Stream service temporarily unavailable."}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("button",{onClick:()=>z(!w),className:"w-full flex items-center justify-between py-3 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-pnp-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"text-sm font-medium text-pnp-textPrimary",children:"Book a Private Session"})]}),e.jsx("svg",{className:`w-4 h-4 text-pnp-textSecondary transition-transform ${w?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"flex gap-2 mb-3",children:e.jsx(Q,{variant:"secondary",size:"sm",onClick:()=>window.open(O,"_blank"),children:"Open Full Calendar"})}),e.jsxs("div",{className:"embed-frame relative",style:{minHeight:"500px"},children:[!I&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-pnp-accent border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-pnp-textSecondary",children:"Loading booking..."})]})}),e.jsx("iframe",{src:O,className:"w-full border-0 rounded-xl",style:{height:"600px",opacity:I?1:0},onLoad:()=>F(!0),allow:"camera; microphone",title:"Booking Calendar"})]}),e.jsx(p,{className:"mt-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-4 h-4 text-pnp-accent flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-xs text-pnp-textSecondary",children:"Sessions are scheduled in your local timezone. You'll receive a confirmation with details."})]})})]})]})]})}export{re as default};
