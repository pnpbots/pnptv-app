import{u as S,q as U,r as D,j as e}from"./index-Cn0k-BHZ.js";import{r as l,u as R}from"./vendor-DD6IjSBT.js";import{u as $,D as C}from"./useDirectus-CY-75GOS.js";import"./auth-BkcVUzVN.js";function A(a){if(!a)return"";const u=Date.now()-new Date(a).getTime(),t=Math.floor(u/6e4);if(t<1)return"now";if(t<60)return`${t}m`;const r=Math.floor(t/60);return r<24?`${r}h`:`${Math.floor(r/24)}d`}function F(a){return!!a&&a.startsWith("video/")}function V(){const{user:a,isAuthenticated:u}=S(),[t,r]=l.useState(""),[m,j]=l.useState(null),[n,p]=l.useState(null),[i,v]=l.useState(!1),[g,b]=l.useState(null),[h,N]=l.useState(null),o=l.useRef(null),{data:w,isLoading:L,error:y,refetch:c}=$({collection:"social_posts",params:{sort:["-date_created"],limit:50,fields:["*","media.id","media.type","media.width","media.height","media.filename_download"],filter:{status:{_eq:"published"}}}}),_=l.useCallback(s=>{var E;const d=(E=s.target.files)==null?void 0:E[0];d&&(j(d),p(URL.createObjectURL(d)))},[]),f=l.useCallback(()=>{j(null),n&&URL.revokeObjectURL(n),p(null),o.current&&(o.current.value="")},[n]),M=l.useCallback(async()=>{if(!(!t.trim()||i)){v(!0),b(null);try{await U(t.trim(),m||void 0),r(""),f(),c()}catch(s){b(s instanceof Error?s.message:"Failed to create post")}finally{v(!1)}}},[t,m,i,f,c]),P=l.useCallback(async s=>{if(!h){N(s);try{await D(s),c()}catch{}finally{N(null)}}},[h,c]),x=String((a==null?void 0:a.id)||""),k=R();return e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Social Feed"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#8E8E93"},children:"Share updates with the PNPTV community"})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full font-medium",style:{background:"rgba(255,180,84,0.15)",color:"#FFB454"},children:"Community"})]}),u&&e.jsx("div",{className:"glass-card-sm p-4 mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",style:{background:"rgba(212, 0, 122, 0.2)",color:"#D4007A"},children:((a==null?void 0:a.displayName)||"U")[0].toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:t,onChange:s=>r(s.target.value.slice(0,500)),placeholder:"What's on your mind?",className:"w-full bg-transparent text-white text-sm py-2 border-b border-white/10 mb-3 resize-none outline-none placeholder:text-white/40",rows:3,disabled:i}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("span",{className:`text-xs ${t.length>450?"text-red-400":""}`,style:{color:t.length>450?void 0:"#8E8E93"},children:[t.length,"/500"]})}),n&&e.jsxs("div",{className:"relative mb-3 inline-block",children:[m&&m.type.startsWith("video/")?e.jsx("video",{src:n,className:"max-h-48 rounded-lg object-cover",muted:!0}):e.jsx("img",{src:n,alt:"Preview",className:"max-h-48 rounded-lg object-cover"}),e.jsx("button",{onClick:f,className:"absolute top-1 right-1 w-6 h-6 rounded-full flex items-center justify-center text-white text-xs",style:{background:"rgba(0,0,0,0.7)"},children:"×"})]}),g&&e.jsx("p",{className:"text-xs text-red-400 mb-2",children:g}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",style:{color:"#8E8E93"},children:[e.jsx("input",{ref:o,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif,video/mp4,video/webm",className:"hidden",onChange:_}),e.jsx("button",{onClick:()=>{var s;return(s=o.current)==null?void 0:s.click()},disabled:i,className:"hover:text-pnp-accent transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("button",{onClick:()=>{var s;return(s=o.current)==null?void 0:s.click()},disabled:i,className:"hover:text-pnp-accent transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),e.jsx("button",{onClick:M,disabled:!t.trim()||i,className:"btn-gradient px-4 py-1.5 rounded-lg text-white text-sm font-semibold disabled:opacity-40",children:i?"Posting...":"Post"})]})]})]})}),L?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,d)=>e.jsx("div",{className:"glass-card-sm p-4 animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-3 bg-white/10 rounded w-32"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-full"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-3/4"})]})]})},d))}):y?e.jsxs("div",{className:"glass-card-sm p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",style:{color:"#8E8E93"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("p",{className:"text-white font-medium mb-1",children:"Feed Unavailable"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"#8E8E93"},children:y}),e.jsx("button",{onClick:c,className:"btn-gradient px-4 py-1.5 rounded-lg text-white text-sm font-semibold",children:"Retry"})]}):w.length===0?e.jsxs("div",{className:"glass-card-sm p-8 text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",style:{color:"#8E8E93"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),e.jsx("p",{className:"text-white font-medium mb-1",children:"No Posts Yet"}),e.jsx("p",{className:"text-sm",style:{color:"#8E8E93"},children:"Be the first to share something with the community!"})]}):e.jsx("div",{className:"space-y-3",children:w.map(s=>e.jsx("div",{className:"glass-card-sm p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>s.author_id&&k(s.author_id===x?"/profile":`/profile/${s.author_id}`),className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",style:{background:"rgba(212, 0, 122, 0.2)",color:"#D4007A"},children:(s.author_name||"?")[0].toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>s.author_id&&k(s.author_id===x?"/profile":`/profile/${s.author_id}`),className:"font-semibold text-white text-sm truncate hover:underline",children:s.author_name||"Anonymous"}),e.jsxs("span",{className:"text-xs",style:{color:"#8E8E93"},children:["· ",A(s.date_created)]}),x&&s.author_id===x&&e.jsx("button",{onClick:()=>P(s.id),disabled:h===s.id,className:"ml-auto text-xs hover:text-red-400 transition-colors",style:{color:"#8E8E93"},title:"Delete post",children:h===s.id?e.jsx("span",{className:"text-xs",children:"..."}):e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("p",{className:"text-sm text-white/90 mt-1.5 whitespace-pre-wrap leading-relaxed",children:s.text}),s.media&&e.jsx("div",{className:"mt-3",children:F(s.media.type)?e.jsx("video",{src:`${C}/assets/${s.media.id}`,controls:!0,className:"w-full max-h-80 rounded-lg object-cover",preload:"metadata"}):e.jsx("img",{src:`${C}/assets/${s.media.id}?width=600&quality=80`,alt:"",className:"w-full max-h-80 rounded-lg object-cover",loading:"lazy"})})]})]})},s.id))})]})}export{V as default};
