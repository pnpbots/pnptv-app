import{r as p}from"./vendor-DD6IjSBT.js";function R(e){return e?`/auth/login/${e}`:"/auth/login"}var b="/",x=(e,t)=>(e.endsWith(b)&&(e=e.slice(0,-1)),t.startsWith(b)||(t=b+t),e+t),_=(e,t,r)=>{let i=e.pathname===b?t:x(e.pathname,t),s=new globalThis.URL(i,e);if(r)for(let[o,a]of Object.entries(W(r)))if(a&&typeof a=="object"&&!Array.isArray(a))for(let[c,u]of Object.entries(a))s.searchParams.set(`${o}[${c}]`,String(u));else s.searchParams.set(o,a);return s};function O(e){return typeof e!="object"||!e?!1:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function v(e){var t;if(!(typeof e!="object"||!e)){if(O(e)){let r=(t=e.headers.get("Content-Type"))==null?void 0:t.toLowerCase();if(r!=null&&r.startsWith("application/json")||r!=null&&r.startsWith("application/health+json")){let i=await e.json();if(!e.ok||"errors"in i)throw i;return"data"in i?i.data:i}if(r!=null&&r.startsWith("text/html")||r!=null&&r.startsWith("text/plain")){let i=await e.text();if(!e.ok)throw i;return i}return e}if("errors"in e)throw e;return"data"in e?e.data:e}}var w=async(e,t,r=globalThis.fetch)=>(t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{},r(e,t).then(i=>v(i).catch(s=>{let o={errors:s&&typeof s=="object"&&"errors"in s?s.errors:s,response:i};return s&&typeof s=="object"&&"data"in s&&(o.data=s.data),Promise.reject(o)}))),C=()=>{let e=null;return{get:async()=>e,set:async t=>{e=t}}},E={msRefreshBeforeExpires:3e4,autoRefresh:!0},A=2**31-1,B=(e="cookie",t={})=>r=>{let i={...E,...t},s=null,o=null,a=i.storage??C(),c=async()=>a.set({access_token:null,refresh_token:null,expires:null,expires_at:null}),u=async()=>{try{await s}finally{s=null}},d=async()=>{let n=await a.get();return s||!(n!=null&&n.expires_at)||n.expires_at<new Date().getTime()+i.msRefreshBeforeExpires&&y().catch(l=>{}),u()},g=async n=>{let l=n.expires??0;n.expires_at=new Date().getTime()+l,await a.set(n),i.autoRefresh&&l>i.msRefreshBeforeExpires&&l<A&&(o&&clearTimeout(o),o=setTimeout(()=>{o=null,y().catch(f=>{})},l-i.msRefreshBeforeExpires))},y=async()=>(s=(async()=>{let n=await a.get();await c();let l={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in i&&(l.credentials=i.credentials);let f={mode:e};e==="json"&&(n!=null&&n.refresh_token)&&(f.refresh_token=n.refresh_token),l.body=JSON.stringify(f);let h=_(r.url,"/auth/refresh");return w(h.toString(),l,r.globals.fetch).then(m=>g(m).then(()=>m))})(),s);return{refresh:y,async login(n,l,f={}){await c();let h={email:n,password:l};"otp"in f&&(h.otp=f.otp),h.mode=f.mode??e;let m=R(f.provider),k=_(r.url,m),j={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)};"credentials"in i&&(j.credentials=i.credentials);let S=await w(k.toString(),j,r.globals.fetch);return await g(S),S},async logout(){let n=await a.get(),l={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in i&&(l.credentials=i.credentials);let f={mode:e};e==="json"&&(n!=null&&n.refresh_token)&&(f.refresh_token=n.refresh_token),l.body=JSON.stringify(f);let h=_(r.url,"/auth/logout");await w(h.toString(),l,r.globals.fetch),this.stopRefreshing(),await c()},stopRefreshing(){o&&clearTimeout(o)},async getToken(){var n;return await d().catch(()=>{}),((n=await a.get())==null?void 0:n.access_token)??null},async setToken(n){return a.set({access_token:n,refresh_token:null,expires:null,expires_at:null})}}},T={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},J=(e,t={})=>{let r=t.globals?{...T,...t.globals}:T;return{globals:r,url:new r.URL(e),with(i){return{...this,...i(this)}}}};function L(e){return["directus_access","directus_activity","directus_collections","directus_comments","directus_fields","directus_files","directus_folders","directus_migrations","directus_permissions","directus_policies","directus_presets","directus_relations","directus_revisions","directus_roles","directus_sessions","directus_settings","directus_users","directus_webhooks","directus_dashboards","directus_panels","directus_notifications","directus_shares","directus_flows","directus_operations","directus_translations","directus_versions","directus_extensions"].includes(e)}var N=e=>{let t=(r,i=[])=>{if(typeof r=="object"){let s=[];for(let o in r){let a=r[o]??[];if(Array.isArray(a))for(let c of a)s.push(t(c,[...i,o]));else if(typeof a=="object")for(let c of Object.keys(a)){let u=a[c];for(let d of u)s.push(t(d,[...i,`${o}:${c}`]))}}return s.flatMap(o=>o)}return[...i,String(r)].join(".")};return e.flatMap(r=>t(r))},W=e=>{let t={};Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=N(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[r,i]of Object.entries(e))r in t||(typeof i=="string"||typeof i=="number"||typeof i=="boolean"?t[r]=String(i):t[r]=JSON.stringify(i));return t},$=(e,t)=>{if(e.length===0)throw new Error(t)},D=(e,t)=>{if(L(String(e)))throw new Error(t)},U=(e,t)=>()=>($(String(e),"Collection cannot be empty"),D(e,"Cannot use readItems for core collections"),{path:`/items/${e}`,params:t??{},method:"GET"}),q={},P=(e={})=>t=>{let r={...q,...e};return{async request(i){let s=i();if(s.headers||(s.headers={}),"Content-Type"in s.headers?s.headers["Content-Type"]==="multipart/form-data"&&delete s.headers["Content-Type"]:s.headers["Content-Type"]="application/json","getToken"in this&&!("Authorization"in s.headers)){let u=await this.getToken();u&&(s.headers.Authorization=`Bearer ${u}`)}let o=_(t.url,s.path,s.params),a={method:s.method??"GET",headers:s.headers??{}};"credentials"in r&&(a.credentials=r.credentials),s.body&&(a.body=s.body),s.onRequest&&(a=await s.onRequest(a)),r.onRequest&&(a=await r.onRequest(a));let c=await w(o.toString(),a,t.globals.fetch);return"onResponse"in s&&(c=await s.onResponse(c,a)),"onResponse"in e&&(c=await e.onResponse(c,a)),c}}};const G="https://cms.pnptv.app",I=J(G).with(B("json")).with(P());function z({collection:e,params:t={},enabled:r=!0}){const[i,s]=p.useState([]),[o,a]=p.useState(!0),[c,u]=p.useState(null),[d,g]=p.useState(0);return p.useEffect(()=>{if(!r){a(!1);return}let n=!1;return a(!0),u(null),I.request(U(e,t)).then(l=>{n||s(l)}).catch(l=>{n||u((l==null?void 0:l.message)||"Failed to fetch data")}).finally(()=>{n||a(!1)}),()=>{n=!0}},[e,r,d]),{data:i,isLoading:o,error:c,refetch:()=>g(n=>n+1)}}export{G as D,z as u};
