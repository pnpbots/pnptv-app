# Matrix Synapse Configuration - PNPTV
server_name: "matrix.pnptv.app"
pid_file: /data/homeserver.pid
public_baseurl: "https://matrix.pnptv.app/"

listeners:
  - port: 8008
    resources:
    - compress: false
      names:
      - client
      - federation
    tls: false
    type: http
    x_forwarded: true

database:
  name: psycopg2
  args:
    user: synapse_user
    password: d5b0ff1ddbf7079bd3394666033c10f6bbe732c68a7ef71de643c22e06eb0da7
    database: synapse_db
    host: pg-synapse
    port: 5432
    cp_min: 5
    cp_max: 10

log_config: "/data/matrix.pnptv.app.log.config"
media_store_path: /data/media_store

# Registration (invite-only via shared secret)
enable_registration: false
registration_shared_secret: ":#DWz*o&yO,koa8yBr4HoWBJ#g22ebMZOZI:8Wx5as0C=dO;vi"

# Guest access disabled
allow_guest_access: false

# Rate limiting
rc_message:
  per_second: 5
  burst_count: 20
rc_registration:
  per_second: 0.5
  burst_count: 3

# Security
report_stats: false
macaroon_secret_key: "#VldDUofZ1O-hwlWPej,z65vq32,N&t:5AOuhWiL8vkvVUrV,#"
form_secret: "NKfk;ex_J8KOU*2WQL#esvniQtS4A1iOlcxtl6O5yNC-E4=vqf"
signing_key_path: "/data/matrix.pnptv.app.signing.key"

# Federation
trusted_key_servers:
  - server_name: "matrix.org"

# URL previews
url_preview_enabled: true
url_preview_ip_range_blacklist:
  - '127.0.0.0/8'
  - '10.0.0.0/8'
  - '172.16.0.0/12'
  - '192.168.0.0/16'
  - '100.64.0.0/10'
  - '192.0.0.0/24'
  - '169.254.0.0/16'
  - '198.18.0.0/15'
  - '::1/128'
  - 'fe80::/10'
  - 'fc00::/7'
  - '2001:db8::/32'
  - 'ff00::/8'
  - 'fec0::/10'

# Retention policy
retention:
  enabled: true
  default_policy:
    min_lifetime: 1d
    max_lifetime: 365d

# Media storage limits
max_upload_size: 50M
